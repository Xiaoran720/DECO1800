<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapbox Map with Time Slider and Marker Filter</title>

    <!-- 引入 Mapbox CSS -->
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
    
    <style>
        #map {
            height: 80vh;
            width: 80vw;
            margin-bottom: 20px;
        }
        #controls {
            margin: 10px;
        }
        #time-slider-container {
            margin-top: 20px;
        }
        #time-slider1,
        #time-slider2 {
            width: 300px; /* 设置滑块的宽度，确保其可见 */
        }
        #timeRange {
            margin-left: 10px;
        }
    </style>
</head>
<body>

    <h3>Mapbox Map with Time Slider and Marker Filter</h3>

    <!-- 筛选器 -->
    <div id="controls">
        <!-- 标记筛选复选框 -->
        <div id="filters">
            <input type="checkbox" id="brisbane" checked> Brisbane<br>
            <input type="checkbox" id="southbank" checked> South Bank Parklands<br>
            <input type="checkbox" id="koala" checked> Lone Pine Koala Sanctuary<br>
            <input type="checkbox" id="lookout" checked> Mount Coot-Tha Lookout<br>
        </div>

        <!-- 时间轴 (双滑块) -->
        <div id="time-slider-container">
            <label for="timeSlider">Time range:</label><br>
            <input type="range" id="timeSlider1" min="2010" max="2020" value="2010">
            <input type="range" id="timeSlider2" min="2010" max="2020" value="2020">
            <span id="timeRange">2010 - 2020</span>
        </div>
    </div>

    <!-- 地图容器 -->
    <div id="map"></div>

    <!-- 引入 Mapbox JavaScript -->
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>

    <script>
        // 使用你的 Mapbox 公有令牌
        mapboxgl.accessToken = 'pk.eyJ1IjoibHlsNTI1IiwiYSI6ImNtMHg3dDl5dzA5bDcycnB5ZzluZzRueXUifQ.P5n5ikx90MtIu4-NzSEmgQ';

        // 初始化 Mapbox 地图
        var map = new mapboxgl.Map({
            container: 'map', // 绑定地图到id为map的HTML元素
            style: 'mapbox://styles/mapbox/streets-v11', // 地图样式
            center: [153.021072, -27.470125], // 布里斯班的经纬度
            zoom: 12 // 设置缩放级别
        });

        // 创建标记并添加时间戳
        var markers = {
            brisbane: { marker: new mapboxgl.Marker().setLngLat([153.021072, -27.470125]).setPopup(new mapboxgl.Popup().setHTML("<h3>Brisbane City</h3><p>2012</p>")), year: 2012 },
            southbank: { marker: new mapboxgl.Marker({ color: 'red' }).setLngLat([153.027797, -27.481929]).setPopup(new mapboxgl.Popup().setHTML("<h3>South Bank Parklands</h3><p>2014</p>")), year: 2014 },
            koala: { marker: new mapboxgl.Marker({ color: 'green' }).setLngLat([152.957004, -27.531335]).setPopup(new mapboxgl.Popup().setHTML("<h3>Lone Pine Koala Sanctuary</h3><p>2018</p>")), year: 2018 },
            lookout: { marker: new mapboxgl.Marker({ color: 'blue' }).setLngLat([152.951895, -27.469770]).setPopup(new mapboxgl.Popup().setHTML("<h3>Mount Coot-Tha Lookout</h3><p>2018</p>")), year: 2018 }
        };

        // 显示或隐藏标记的函数，结合时间范围和复选框状态
        function toggleMarkers() {
            var startYear = parseInt(document.getElementById('timeSlider1').value);
            var endYear = parseInt(document.getElementById('timeSlider2').value);

            // 更新时间范围显示
            document.getElementById('timeRange').textContent = startYear + ' - ' + endYear;

            Object.keys(markers).forEach(function(key) {
                var isChecked = document.getElementById(key).checked;
                var markerYear = markers[key].year;
                if (isChecked && markerYear >= startYear && markerYear <= endYear) {
                    markers[key].marker.addTo(map); // 显示标记
                } else {
                    markers[key].marker.remove(); // 隐藏标记
                }
            });
        }

        // 绑定复选框事件监听器
        document.getElementById('brisbane').addEventListener('change', toggleMarkers);
        document.getElementById('southbank').addEventListener('change', toggleMarkers);
        document.getElementById('koala').addEventListener('change', toggleMarkers);
        document.getElementById('lookout').addEventListener('change', toggleMarkers);

        // 绑定时间滑块事件监听器
        document.getElementById('timeSlider1').addEventListener('input', toggleMarkers);
        document.getElementById('timeSlider2').addEventListener('input', toggleMarkers);

        // 初始化时调用
        toggleMarkers();
    </script>

</body>
</html>
